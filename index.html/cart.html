<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cart - Prakash Shoe Center</title>

<link rel="stylesheet" href="styles.css" />

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f8f8f8;
  }

  header {
    background: #222;
    color: white;
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }

  .logo {
    font-size: 1.4em;
    font-weight: bold;
  }

  nav ul {
    list-style: none;
    display: flex;
    gap: 15px;
    padding: 0;
    margin: 0;
  }

  nav a {
    color: white;
    text-decoration: none;
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    background: #333;
    padding: 10px;
    list-style: none;
    top: 30px;
  }

  .dropdown:hover .dropdown-menu {
    display: block;
  }

  input#search-input {
    padding: 6px;
    margin-left: 20px;
    border-radius: 5px;
    border: none;
  }

  main {
    padding: 20px;
  }

  .cart-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    max-width: 700px;
    margin: 20px auto;
  }

  .cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #ddd;
    padding: 10px 0;
  }

  .cart-item:last-child {
    border-bottom: none;
  }

  .cart-total {
    margin-top: 15px;
    font-size: 1.2em;
  }

  button {
    background: #007bff;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
  }

  button:hover {
    background: #0056b3;
  }

  .remove-btn {
    background: #e74c3c;
  }

  .remove-btn:hover {
    background: #c0392b;
  }

  #checkout-btn {
    width: 100%;
    margin-top: 15px;
    padding: 10px;
    font-size: 1em;
  }

  .notification {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #4caf50;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    display: none;
    z-index: 1000;
  }

  @media (max-width: 600px) {
    .cart-item {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>
</head>

<body>

<!-- ‚úÖ EmailJS Library -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  (function() {
    emailjs.init("Zsj5PqasAnS6hddBQ"); // ‚ö†Ô∏è Replace with your EmailJS Public Key
  })();
</script>

<header>
  <div class="logo">Prakash Shoe Center</div>
  <nav>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li class="dropdown">
        <a href="#">Categories ‚ñº</a>
        <ul class="dropdown-menu">
          <li><a href="shoes.html">Shoes</a></li>
          <li><a href="slippers.html">Slippers</a></li>
          <li><a href="sandals.html">Sandals</a></li>
          <li><a href="gumboots.html">Gumboots</a></li>
          <li><a href="football-boots.html">Football Boots</a></li>
          <li><a href="socks.html">Socks</a></li>
        </ul>
      </li>
      <li><a href="cart.html">Cart üõí (<span id="cart-count">0</span>)</a></li>
    </ul>
    <input type="text" id="search-input" placeholder="Search shoes..." />
  </nav>
</header>

<main>
  <section class="cart-section">
    <h2>Your Cart</h2>
    <div id="cart-items"></div>
    <div class="cart-total">
      <strong>Total:</strong> NPR <span id="total-price">0</span>
    </div>

    <input type="text" id="contact-number" placeholder="Enter your contact number" 
      style="width:100%;margin-top:10px;padding:8px;border-radius:5px;border:1px solid #ccc;" />

    <textarea id="address" placeholder="Enter your delivery address" 
      style="width:100%;margin-top:10px;padding:8px;border-radius:5px;border:1px solid #ccc;height:80px;"></textarea>

    <button id="checkout-btn" disabled>Place Order (Cash on Delivery)</button>
  </section>
</main>

<div id="notification" class="notification"></div>

<script>
  // === Notification ===
  function showNotification(message, duration = 3000) {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style.display = 'block';
    setTimeout(() => notification.style.display = 'none', duration);
  }

  // === Cart Storage ===
  function loadCart() {
    try {
      return JSON.parse(localStorage.getItem('cart')) || [];
    } catch {
      return [];
    }
  }

  function saveCart(cart) {
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
  }

  function updateCartCount() {
    const cart = loadCart();
    const count = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
    document.getElementById('cart-count').textContent = count;
  }

  const cartItemsContainer = document.getElementById('cart-items');
  const totalPriceEl = document.getElementById('total-price');
  const checkoutBtn = document.getElementById('checkout-btn');

  // === Render Cart ===
  function renderCart() {
    const cart = loadCart();
    cartItemsContainer.innerHTML = '';

    if (cart.length === 0) {
      cartItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
      checkoutBtn.disabled = true;
      totalPriceEl.textContent = '0';
      updateCartCount();
      return;
    }

    checkoutBtn.disabled = false;
    let total = 0;

    cart.forEach((item, index) => {
      total += (item.price || 0) * (item.quantity || 1);

      const itemDiv = document.createElement('div');
      itemDiv.className = 'cart-item';
      itemDiv.innerHTML = `
        <div>
          <strong>${item.name}</strong><br />
          ${item.size ? `Size: ${item.size} | ` : ''}${item.color ? `Color: ${item.color}` : ''}<br />
          Price: NPR ${item.price}<br />
          Quantity:
          <button class="qty-btn" data-index="${index}" data-action="decrease">-</button>
          <span class="qty-value">${item.quantity}</span>
          <button class="qty-btn" data-index="${index}" data-action="increase">+</button>
        </div>
        <button class="remove-btn" data-index="${index}">Remove</button>
      `;
      cartItemsContainer.appendChild(itemDiv);
    });

    totalPriceEl.textContent = total.toFixed(2);

    // Quantity update
    document.querySelectorAll('.qty-btn').forEach(btn => {
      btn.onclick = () => {
        const idx = btn.dataset.index;
        const action = btn.dataset.action;
        const cart = loadCart();

        if (action === 'increase') cart[idx].quantity++;
        else if (action === 'decrease' && cart[idx].quantity > 1) cart[idx].quantity--;

        saveCart(cart);
        renderCart();
      };
    });

    // Remove item
    document.querySelectorAll('.remove-btn').forEach(btn => {
      btn.onclick = () => {
        const idx = btn.dataset.index;
        const cart = loadCart();
        cart.splice(idx, 1);
        saveCart(cart);
        renderCart();
        showNotification('Item removed from cart.');
      };
    });

    updateCartCount();
  }

  // === EmailJS Order Send ===
  function sendOrderEmail(cart, contactNumber, address, total) {
    const productDetails = cart.map(item => `${item.name} (x${item.quantity}) - NPR ${item.price}`).join(', ');
    const templateParams = {
      product_name: productDetails,
      contact_number: contactNumber,
      address: address,
      total_amount: total
    };

    emailjs.send("service_zf3pwqo", "template_lq8n8b3", templateParams)
      .then(() => {
        showNotification('‚úÖ Order email sent successfully!');
      })
      .catch(() => {
        showNotification('‚ùå Failed to send order email.');
      });
  }

  // === Checkout ===
  checkoutBtn.onclick = () => {
    const contactNumber = document.getElementById('contact-number').value.trim();
    const address = document.getElementById('address').value.trim();

    if (!contactNumber || !address) {
      showNotification('‚ö†Ô∏è Please enter both contact number and address.');
      return;
    }

    const cart = loadCart();
    if (cart.length === 0) {
      showNotification('üõí Your cart is empty.');
      return;
    }

    const total = cart.reduce((sum, i) => sum + i.price * i.quantity, 0);

    sendOrderEmail(cart, contactNumber, address, total);
    alert('‚úÖ Thank you for your order! Payment will be collected on delivery.');
    localStorage.removeItem('cart');
    renderCart();
  };

  // === Search Bar ===
  const allProducts = [
    { id: 'shoe1', name: 'Men Classic Leather Shoes', price: 2800 },
    { id: 'shoe2', name: 'Women Elegant Sandals', price: 2400 },
    { id: 'shoe3', name: 'Kids Sporty Sneakers', price: 2100 },
    { id: 'slipper1', name: 'Men Comfortable Slippers', price: 1200 },
    { id: 'gumboot1', name: 'Durable Gumboots for Rain', price: 2900 },
    { id: 'sock1', name: 'Pack of Cotton Socks', price: 600 }
  ];

  document.getElementById('search-input').addEventListener('keypress', e => {
    if (e.key === 'Enter') {
      const query = e.target.value.toLowerCase();
      const match = allProducts.find(p => p.name.toLowerCase().includes(query));
      if (match) window.location.href = `product.html?id=${match.id}`;
      else showNotification('No product found.');
    }
  });

  // === Init ===
  document.addEventListener('DOMContentLoaded', () => {
    renderCart();
    updateCartCount();
  });
</script>
</body>
</html>
